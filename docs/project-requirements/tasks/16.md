# Task 16: Material Substitution Suggestions Tool

**Dependencies:** Task 3, Task 14

### Goal
Create a Mastra tool that allows supplier agents to suggest material alternatives for cost reduction, quality improvement, or delivery optimization.

### Implementation Context
**Files to Create:**
- `src/mastra/tools/material-substitution-tool.ts`

**Files to Modify:**
- `src/mastra/tools/index.ts` - Export the tool
- `src/mastra/agents/supplier-agent.ts` - Add tool to supplier agents

**Key Requirements:**
- Suppliers can suggest swapping materials for cheaper alternatives
- Suggestions include cost/quality trade-off analysis
- Materials data can be simulated (doesn't need to be real)
- Tool returns structured suggestion data for agent to communicate

**Technical Notes:**
- Use `createTool` from `@mastra/core/tools`
- Define clear input/output schemas with Zod
- Simulated materials database for prototype
- Tool provides data, agent formats natural language response

**From Goal Requirements:**
> "Supplier could suggest swapping some materials for cheaper alternatives to reduce cost, or other ideas that make sense in this business context"

**Mastra Tool Pattern:**
```typescript
import { createTool } from "@mastra/core/tools";
import { z } from "zod";

export const materialSubstitutionTool = createTool({
  id: "suggest-material-substitution",
  description: "Suggest alternative materials that could reduce cost or improve quality",
  inputSchema: z.object({
    productId: z.string(),
    targetMetric: z.enum(["cost", "quality", "lead_time"]),
    currentMaterial: z.string().optional(),
  }),
  outputSchema: z.object({
    suggestions: z.array(z.object({
      originalMaterial: z.string(),
      alternativeMaterial: z.string(),
      costChange: z.number(), // percentage, negative = savings
      qualityImpact: z.string(),
      leadTimeImpact: z.string(),
      recommendation: z.string(),
    })),
  }),
  execute: async ({ context }) => {
    // Return simulated material suggestions
    return { suggestions: [...] };
  },
});
```

### Scope Definition
**Deliverables:**
- `materialSubstitutionTool`: Mastra tool for material suggestions
- Simulated materials database with realistic alternatives
- Integration with supplier agents

**Material Categories (Simulated):**
| Category | Original | Alternative | Cost Δ | Quality Δ |
|----------|----------|-------------|--------|-----------|
| Upper | Premium Leather | Synthetic Leather | -30% | Slight decrease |
| Sole | EVA Foam | Recycled Rubber | -15% | Comparable |
| Lining | Mesh Fabric | Knit Textile | -10% | Improved breathability |
| Laces | Cotton | Polyester | -20% | More durable |

**Exclusions:**
- Real materials database integration
- Supplier-specific material availability
- Complex manufacturing impact analysis

### Implementation Steps

1. **Create materials database** (simulated):
   ```typescript
   const materialsDb = {
     "premium-leather": {
       name: "Premium Leather",
       category: "upper",
       costPerUnit: 15.00,
       qualityRating: 4.8,
     },
     "synthetic-leather": {
       name: "Synthetic Leather",
       category: "upper",
       costPerUnit: 10.50,
       qualityRating: 4.2,
     },
     // ... more materials
   };
   ```

2. **Define input schema:**
   ```typescript
   const inputSchema = z.object({
     productId: z.string().describe("Product to find substitutions for"),
     targetMetric: z.enum(["cost", "quality", "lead_time"]).describe("What to optimize"),
     currentMaterial: z.string().optional().describe("Specific material to replace"),
   });
   ```

3. **Define output schema:**
   ```typescript
   const outputSchema = z.object({
     suggestions: z.array(z.object({
       originalMaterial: z.string(),
       alternativeMaterial: z.string(),
       costChangePercent: z.number(),
       qualityImpact: z.enum(["improved", "comparable", "slight_decrease", "significant_decrease"]),
       leadTimeImpact: z.enum(["faster", "same", "slower"]),
       recommendation: z.string(),
     })),
   });
   ```

4. **Implement execute function:**
   - Look up product components from products.json
   - Find alternative materials from simulated database
   - Calculate cost/quality trade-offs
   - Return structured suggestions

5. **Add tool to supplier agents:**
   ```typescript
   const supplierAgent = new Agent({
     // ...
     tools: { materialSubstitutionTool },
   });
   ```

6. **Test: Tool returns valid suggestions**
   - **Setup:** Product "Pulse Pro High-Top" with target "cost"
   - **Action:** Execute tool
   - **Expect:** Returns 2-3 material substitution suggestions with cost savings

7. **Test: Supplier agent uses tool in negotiation**
   - **Setup:** Brand requests lower price
   - **Action:** Supplier agent responds
   - **Expect:** Agent mentions material substitution option with specific savings

### Success Criteria
- Tool returns realistic material substitution suggestions
- Output schema is validated by Zod
- Supplier agents can use the tool during negotiations
- Suggestions include clear cost/quality trade-offs
- Tool descriptions help agent decide when to use it

### Scope Constraint
Implement the material substitution tool with simulated data. Real materials database integration is out of scope.

