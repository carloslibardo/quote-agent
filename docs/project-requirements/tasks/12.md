# Task 12: Implement error handling and loading states across all UI components

**Dependencies:** Tasks 8, 9, 10, 11

### Goal
Add comprehensive error handling and loading states to all UI components for a polished user experience.

### Implementation Context
**Files to Modify:**
- All page components (CreateQuotePage, NegotiationPage, PastNegotiationsPage)
- All UI components with async operations
- `src/shared/components/ErrorBoundary.tsx` (enhance existing)
- `src/shared/components/LoadingSpinner.tsx` (new)

**Key Requirements:**
- OpenAI API failure: "AI service temporarily unavailable" with retry button
- Network error: "Connection lost" with auto-retry countdown
- Validation error: Inline field errors with red text and icons
- Negotiation timeout: "Negotiation taking longer than expected" with continue/cancel options
- Loading states: Skeleton loaders for data fetching, spinners for actions

**Technical Notes:**
- Use React Query error handling for API failures
- Use existing toast system (Sonner) for transient errors
- Create reusable error components for common scenarios
- Use existing shadcn/ui Skeleton component for loading states
- Implement retry logic with exponential backoff for network errors
- Follow existing error boundary pattern from App.tsx

**Simplicity Decisions:**
- Simple retry mechanism instead of complex queue management
- Toast notifications instead of modal dialogs for most errors
- Generic error messages instead of detailed technical errors

### Scope Definition
**Deliverables:**
- Error handling for OpenAI API failures
- Network error handling with auto-retry
- Validation error display (inline and toast)
- Negotiation timeout handling
- Loading skeletons for all data fetching
- Loading spinners for all actions (button states)
- Enhanced error boundary with better fallback UI

**Exclusions:**
- Detailed error logging/monitoring (out of scope)
- Custom error reporting service (out of scope)

### Implementation Steps
1. Create `src/shared/components/LoadingSpinner.tsx` reusable component
2. Add loading states to CreateQuotePage: skeleton for products, disabled button during submission
3. Add loading states to NegotiationPage: skeleton for messages, spinner during intervention send
4. Add loading states to PastNegotiationsPage: skeleton list during fetch
5. Implement OpenAI API error handling in agent actions: catch errors, return user-friendly message
6. Add retry button to error toasts for recoverable errors
7. Implement network error detection: check for network failure, show "Connection lost" toast
8. Add auto-retry with countdown: retry after 5s, 10s, 20s (exponential backoff)
9. Enhance validation error display: inline errors on form fields, summary toast on submit
10. Add negotiation timeout detection in orchestration action: if negotiation exceeds 5 minutes, show timeout message
11. Provide continue/cancel options for timeout: continue extends timeout, cancel marks negotiation as impasse
12. Enhance ErrorBoundary fallback UI: show friendly error message with "Go Home" button
13. **Test: OpenAI API failure shows retry option**
   - **Setup:** Mock OpenAI API to return error
   - **Action:** Start negotiation
   - **Expect:** Error toast with "AI service temporarily unavailable" and retry button
14. **Test: Network error triggers auto-retry**
   - **Setup:** Simulate network disconnection
   - **Action:** Send intervention message
   - **Expect:** "Connection lost" toast with countdown, auto-retry after delay

### Success Criteria
- All async operations show loading states
- API failures display user-friendly error messages
- Network errors trigger auto-retry with countdown
- Validation errors shown inline and in toast
- Negotiation timeouts handled gracefully
- Retry mechanisms work correctly
- Error boundary catches unhandled errors
- All error messages are clear and actionable

### Scope Constraint
Implement only user-facing error handling and loading states. Do not implement backend error logging or monitoring.